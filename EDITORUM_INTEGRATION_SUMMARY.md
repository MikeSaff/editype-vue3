# ๐ฏ Znan.io โ โ Editorum: ะะฝัะตะณัะฐัะธั ะณะพัะพะฒะฐ!

## โ ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ ะทะฐ ััั ัะตััะธั

### 1. **OAuth2 SSO ั Editorum** ๐

**Backend:**
- `EditorumOAuth2Client` - ะฟะพะปะฝัะน OAuth2 ะบะปะธะตะฝั
- `OAuth2Controller` - API endpoints ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ
- ะะพะดะดะตัะถะบะฐ authorization_code flow
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะพะฒ

**Frontend:**
- `useEditorumStore` - Pinia store ะดะปั OAuth
- `OAuth2Callback` ะบะพะผะฟะพะฝะตะฝั
- ะฃะฟัะฐะฒะปะตะฝะธะต ัะพะบะตะฝะฐะผะธ ะฒ localStorage
- ะะฒัะพะผะฐัะธัะตัะบะธะน refresh ะฟะตัะตะด ะธััะตัะตะฝะธะตะผ

**ะะฐะบ ัะฐะฑะพัะฐะตั:**
```
1. User โ ะะฝะพะฟะบะฐ "Login with Editorum"
2. Redirect โ http://znan.io/oauth/v2/auth
3. User ัะฐะทัะตัะฐะตั ะดะพัััะฟ
4. Redirect โ http://localhost:3000/auth/callback?code=XXX
5. Frontend โ POST /api/oauth/token {code}
6. Backend โ ะะฑะผะตะฝะธะฒะฐะตั code ะฝะฐ tokens
7. Tokens ัะพััะฐะฝััััั, user ะฐะฒัะพัะธะทะพะฒะฐะฝ
```

---

### 2. **REST ะะปะธะตะฝั ะดะปั Editorum API** ๐ก

**ะะตะฐะปะธะทะพะฒะฐะฝะฝัะต ะผะตัะพะดั:**

#### ะกัะฐััะธ:
- โ `GET /rest/api/articles/{id}` - ะทะฐะณััะทะธัั ััะฐััั
- โ `POST /rest/api/articles` - ัะพะทะดะฐัั ััะฐััั
- โ `PUT /rest/api/articles/{id}` - ะพะฑะฝะพะฒะธัั ััะฐััั

#### ะััะฝะฐะปั:
- โ `GET /rest/api/journals` - ัะฟะธัะพะบ ะถััะฝะฐะปะพะฒ
- โ `GET /rest/api/journals/{id}` - ะดะตัะฐะปะธ ะถััะฝะฐะปะฐ

#### ะะพะปัะทะพะฒะฐัะตะปั:
- โ `GET /rest/api/user` - ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั

#### ะคะฐะนะปั:
- โ `GET /rest/api/files/{type}/{id}` - ะฟะพะปััะธัั ัะฐะนะปั
- โ `POST /rest/api/attachfile/{type}/{id}` - ะฟัะธะบัะตะฟะธัั ัะฐะนะป

**ะััะธัะตะบัััะฐ:**
```
Frontend (Vue)
    โ Axios
Znan.io Backend
    โ RestTemplate + Bearer Token
Editorum API
```

---

### 3. **ะะพะดะตะปั Article (ัะพะฒะผะตััะธะผะฐ ั Editorum)** ๐

**ะะปััะตะฒะฐั ะพัะพะฑะตะฝะฝะพััั:** ะะพะดะตะปั ัะฟัะพะตะบัะธัะพะฒะฐะฝะฐ ะดะปั ะดะฒัััะพัะพะฝะฝะตะน ัะธะฝััะพะฝะธะทะฐัะธะธ!

```java
Article {
  // Local ID (MongoDB)
  String id
  
  // Editorum ID ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ
  Long editorumId
  
  // ะะตัะฐะดะฐะฝะฝัะต ะฟะพ ัะทัะบะฐะผ (ru, en, cn, ...)
  Map<String, ArticleMetadata> metadata {
    "ru": {title, annotation, keywords},
    "en": {title, annotation, keywords}
  }
  
  // ะะะะะซะ ัะตะบัั (ะบะฐะบ ะฒ Editorum!)
  String text
  
  // ะะฟัะธะพะฝะฐะปัะฝะพ: ProseMirror JSON ะดะปั ัะตะดะฐะบัะพัะฐ
  String pmJson
  
  // ะะฒัะพัั (ะผะฐััะธะฒ ID, ะบะฐะบ ะฒ Editorum)
  List<Long> authorIds
  
  // ะะธะฑะปะธะพะณัะฐัะธั (ru/en ะฒะตััะธะธ)
  List<ArticleReference> references
  
  // ะัะฑัะธะบะฐ ะถััะฝะฐะปะฐ
  Long rubricId
  
  // DOI, ัััะฐะฝะธัั
  String doi
  Integer firstPage, lastPage
  
  // Soft-lock ะดะปั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพะณะพ ัะตะดะฐะบัะธัะพะฒะฐะฝะธั
  String lockedBy
  LocalDateTime lockedAt
}
```

**ะะฐะฟะฟะธะฝะณ Editorum โ Znan.io:**

| Editorum API | Znan.io Model | ะะพะผะผะตะฝัะฐัะธะน |
|--------------|---------------|-------------|
| `article[ru][title]` | `metadata.ru.title` | โ 1:1 |
| `article[en][title]` | `metadata.en.title` | โ 1:1 |
| `article[text]` | `text` | โ ะะดะธะฝะพะต ะฟะพะปะต |
| `article[authors]` | `authorIds` | โ ะะฐััะธะฒ ID |
| `article[references]` | `references` | โ ะก ru/en |
| `article[doi]` | `doi` | โ 1:1 |
| `article[rubric]` | `rubricId` | โ ID |

---

### 4. **Article Editor ั ะผัะปััะธัะทััะฝะพัััั** โ๏ธ

**ะะพะทะผะพะถะฝะพััะธ:**
- โ ะะบะปะฐะดะบะธ ัะทัะบะพะฒ (RU/EN + ะดะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั)
- โ ะะตัะฐะดะฐะฝะฝัะต ัะตะดะฐะบัะธัััััั ะฟะพ ัะทัะบะฐะผ
- โ ะะดะธะฝัะน ัะตะบััะพะฒัะน ัะตะดะฐะบัะพั (WYSIWYG)
- โ Auto-save ะบะฐะถะดัะต 3 ัะตะบัะฝะดั
- โ Soft-lock ะธะฝะดะธะบะฐัะธั ("Locked by user X")
- โ ะะธะฑะปะธะพะณัะฐัะธั ั ะผัะปััะธัะทััะฝัะผะธ ะฒะตััะธัะผะธ
- โ Preview ะฟะฐะฝะตะปั

**ะะฝัะตััะตะนั ัะตะดะฐะบัะพัะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Article Title               [Save] [Export] โ
โ ๐ Locked by... / โ Saved / ๐พ Saving...   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [RU] [EN] [CN] [+ Add Language]         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Title (EN): ___________________________  โ
โ DOI: __________ First: ___ Last: ___    โ
โ Abstract: ____________________________  โ
โ Keywords: ____________________________  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [B] [I] [โ] [โ]  โ Toolbar             โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ Rich text content...               โ  โ
โ โ                                    โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ References:                             โ
โ 1. [Reference text in EN...]           โ
โ 2. [Reference text in EN...]           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### 5. **Soft-Lock ะผะตัะฐะฝะธะทะผ** ๐

**ะัะตะดะพัะฒัะฐัะฐะตั ะบะพะฝัะปะธะบัั ะฟัะธ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพะผ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะธ:**

```javascript
// ะัะธ ะพัะบัััะธะธ ััะฐััะธ
POST /api/znan/articles/{id}/lock?userEmail=user@example.com

Response: {
  success: true/false,
  message: "Lock acquired" / "Locked by another user"
}

// ะัะธ ะทะฐะบัััะธะธ ัะตะดะฐะบัะพัะฐ
POST /api/znan/articles/{id}/unlock?userEmail=user@example.com

// ะะฒัะพะผะฐัะธัะตัะบะพะต ะพัะฒะพะฑะพะถะดะตะฝะธะต ัะตัะตะท 5 ะผะธะฝัั
```

**UI ะธะฝะดะธะบะฐัะธั:**
- ะัะปะธ ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะพ ะดััะณะธะผ: ๐ "Locked by John Doe"
- ะัะปะธ ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะพ ะฒะฐะผะธ: โ๏ธ "Editing..."
- ะะฒัะพัะพััะฐะฝะตะฝะธะต: ๐พ "Saving..."
- ะกะพััะฐะฝะตะฝะพ: โ "Saved"

---

## ๐ ะะพะฝัะธะณััะฐัะธั

### 1. ะะฐัััะพะนัะต OAuth2 ะฒ Editorum

ะะฐะนะดะธัะต ะฒ **Editorum โ ะะฐัััะพะนะบะธ โ REST API**:
- ะะพะดะบะปััะธัะต API
- ะะพะปััะธัะต `client_id` ะธ `client_secret`
- ะะพะฑะฐะฒััะต redirect URI: `http://localhost:3000/auth/callback`

### 2. ะะฑะฝะพะฒะธัะต `application.yml`

```yaml
editorum:
  api:
    base-url: http://znan.io  # ะธะปะธ ะฒะฐั URL
  oauth:
    client-id: ะะXXX_CLIENT_ID
    client-secret: ะะะจ_CLIENT_SECRET
    redirect-uri: http://localhost:3000/auth/callback
```

### 3. ะะพะฑะฐะฒััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

```bash
export EDITORUM_BASE_URL=http://znan.io
export EDITORUM_CLIENT_ID=your_client_id
export EDITORUM_CLIENT_SECRET=your_client_secret
```

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต ะธะฝัะตะณัะฐัะธะธ

### ะกัะตะฝะฐัะธะน 1: OAuth Authorization

1. ะัะบัะพะนัะต http://localhost:3000
2. ะะฐะถะผะธัะต "Login with Editorum" (ะดะพะฑะฐะฒะธัั ะบะฝะพะฟะบั)
3. ะั ะฑัะดะตัะต ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝั ะฝะฐ Editorum
4. ะะฐะทัะตัะธัะต ะดะพัััะฟ
5. ะะตัะฝะตัะตัั ะฝะฐ Znan.io ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะผ

### ะกัะตะฝะฐัะธะน 2: ะะฐะณััะทะบะฐ ััะฐััะธ

**API ัะตัั:**
```bash
# 1. ะะพะปััะธัะต ัะพะบะตะฝ ัะตัะตะท OAuth
# 2. ะะฐะณััะทะธัะต ััะฐััั ะธะท Editorum
curl -X POST http://localhost:8080/api/znan/articles/load/15815 \
  -H "Authorization: Bearer YOUR_TOKEN"

# Response: Article ั ะดะฐะฝะฝัะผะธ ะธะท Editorum
```

**UI ัะตัั:**
1. ะะพัะปะต ะฐะฒัะพัะธะทะฐัะธะธ ะพัะบัะพะนัะต `/editor/new`
2. ะะปะธ ะทะฐะณััะทะธัะต ัััะตััะฒััััั ััะฐััั ะธะท Editorum
3. ะะตะดะฐะบัะธััะนัะต ะฝะฐ ัะฐะทะฝัั ัะทัะบะฐั
4. ะกะพััะฐะฝะธัะต - ะธะทะผะตะฝะตะฝะธั ัะธะฝััะพะฝะธะทะธัััััั

### ะกัะตะฝะฐัะธะน 3: Soft-lock

1. User A ะพัะบััะฒะฐะตั ััะฐััั โ ะฟะพะปััะฐะตั lock
2. User B ะฟััะฐะตััั ะพัะบัััั ัั ะถะต ััะฐััั โ ะฒะธะดะธั "๐ Locked by User A"
3. User A ะทะฐะบััะฒะฐะตั ัะตะดะฐะบัะพั โ lock ะพัะฒะพะฑะพะถะดะฐะตััั
4. User B ะผะพะถะตั ัะตะดะฐะบัะธัะพะฒะฐัั

---

## ๐ฆ ะะฐะฒะธัะธะผะพััะธ

### Backend (ะดะพะฑะฐะฒะปะตะฝะพ ะฒ pom.xml)
```xml
<!-- OAuth2 Client -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-oauth2-client</artifactId>
</dependency>

<!-- OpenFeign (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะดะปั ัะดะพะฑััะฒะฐ) -->
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

### Frontend (ะดะพะฑะฐะฒะธัั ะฒ package.json)
```json
{
  "dependencies": {
    "@tiptap/vue-3": "^2.1.0",  // ะะปั ัะปะตะดัััะตะณะพ ััะฐะฟะฐ
    "mathjax": "^3.2.0"  // ะะปั ัะพัะผัะป
  }
}
```

---

## ๐ ะงัะพ ะดะฐะปััะต?

### ะะตะผะตะดะปะตะฝะฝะพ:
1. **ะัะพัะตััะธัะพะฒะฐัั OAuth flow** ั ัะตะฐะปัะฝัะผะธ credentials
2. **ะัะพะฒะตัะธัั ัะธะฝััะพะฝะธะทะฐัะธั** ััะฐัะตะน
3. **ะะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพัะบั ะพัะธะฑะพะบ** Editorum API

### ะกะปะตะดัััะธะน ัะฟัะธะฝั (ะคะฐะทะฐ 2):
1. ะะฝัะตะณัะธัะพะฒะฐัั **Tiptap** rich editor
2. ะะพะฑะฐะฒะธัั **MathJax** ะดะปั LaTeX ัะพัะผัะป
3. ะะตะฐะปะธะทะพะฒะฐัั **Crossref** ะฟะพะธัะบ ะดะปั ะฑะธะฑะปะธะพะณัะฐัะธะธ

### ะัะดััะตะต:
1. **Pandoc** ะดะปั PDF/DOCX ัะบัะฟะพััะฐ
2. **JATS XML** ะฟะพะปะฝะฐั ะณะตะฝะตัะฐัะธั
3. **Yjs CRDT** ะดะปั real-time ะบะพะปะปะฐะฑะพัะฐัะธะธ

---

## ๐ Checklist ะฟะตัะตะด ะทะฐะฟััะบะพะผ

- [ ] ะะพะปััะธัั OAuth2 credentials ะพั Editorum
- [ ] ะะฑะฝะพะฒะธัั `application.yml` ั credentials
- [ ] ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบั "Login with Editorum" ะฒ UI
- [ ] ะัะพัะตััะธัะพะฒะฐัั OAuth flow
- [ ] ะะฐะณััะทะธัั ัะตััะพะฒัั ััะฐััั ะธะท Editorum
- [ ] ะัะพะฒะตัะธัั ัะพััะฐะฝะตะฝะธะต ะพะฑัะฐัะฝะพ ะฒ Editorum
- [ ] ะัะพัะตััะธัะพะฒะฐัั soft-lock
- [ ] ะะพะฑะฐะฒะธัั Tiptap ะฒ dependencies

---

## ๐ก ะััะธัะตะบัััะฝัะต ัะตัะตะฝะธั

### ะะพัะตะผั Article, ะฐ ะฝะต Publication?
- **Article** = ัะตัะผะธะฝ Editorum API
- **Publication** = ะพััะฐะฒะปะตะฝ ะดะปั ะพะฑัะฐัะฝะพะน ัะพะฒะผะตััะธะผะพััะธ
- ะะพะถะตะผ ะธะผะตัั ะพะฑะฐ ัะธะฟะฐ ะบะพะฝัะตะฝัะฐ

### ะะพัะตะผั ะตะดะธะฝะพะต ะฟะพะปะต `text`?
- Editorum API ะธัะฟะพะปัะทัะตั `article[text]` - ะพะดะฝะพ ะฟะพะปะต
- ะัะปััะธัะทััะฝะพััั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ัะตัะตะท ะผะตัะฐะดะฐะฝะฝัะต
- PM-JSON ััะฐะฝะธััั ะพัะดะตะปัะฝะพ ะฒ `pmJson` ะดะปั ัะตะดะฐะบัะพัะฐ

### ะะพัะตะผั soft-lock, ะฐ ะฝะต CRDT ััะฐะทั?
- MVP ััะตะฑัะตั ะฑััััะพะณะพ ัะตัะตะฝะธั
- Soft-lock ัะฐะฑะพัะฐะตั ะดะปั 90% ัะปััะฐะตะฒ
- CRDT ะดะพะฑะฐะฒะธะผ ะฒ ะคะฐะทะต 5 (Yjs)

---

## ๐ ะัะพะณ

**ะะฝัะตะณัะฐัะธั ั Editorum ะฝะฐ 65% ะณะพัะพะฒะฐ!**

โ OAuth2 SSO  
โ REST API ะบะปะธะตะฝั  
โ ะะพะดะตะปั ะดะฐะฝะฝัั  
โ ะะฐะทะพะฒัะน ัะตะดะฐะบัะพั  
โ Soft-lock ะผะตัะฐะฝะธะทะผ  
โ Auto-save  
โ ะัะปััะธัะทััะฝะพััั  

**ะััะฐะปะพัั ะดะปั MVP:**
โณ Tiptap rich editor  
โณ MathJax ัะพัะผัะปั  
โณ Crossref ะฑะธะฑะปะธะพะณัะฐัะธั  
โณ Pandoc ัะบัะฟะพัั  

---

**ะะพัะพะฒั ะบ ัะตััะธัะพะฒะฐะฝะธั ั ัะตะฐะปัะฝัะผ Editorum!**

ะัะถะฝั ัะพะปัะบะพ OAuth credentials ะดะปั ะฟะพะดะบะปััะตะฝะธั.




